<ng-container *ngIf="viewMode$ | async as viewMode">
  <ng-container *ngIf="game$ | async as game">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 col-xl-2 left-rail">
          <scl-download-panel [game]="game"></scl-download-panel>
          <scl-filter-panel [game]="game"></scl-filter-panel>
        </div>

        <main
          class="col-12"
          [ngClass]="{
            'col-xl-5': viewMode !== ViewMode.None,
            'col-xl-8': viewMode === ViewMode.None
          }"
        >
          <div class="d-flex flex-row align-items-center mb-3">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                  {{ game | gameTitle }}
                </li>
              </ol>
            </nav>
            <a
              *ngIf="canEdit$ | async"
              class="btn btn-outline-secondary ml-auto"
              [routerLink]="['/', game, 'enums', 'new']"
              >New Enum</a
            >
          </div>

          <scl-command-list
            [game]="game"
            [canEdit]="canEdit$ | async"
            [narrowed]="
              viewMode !== ViewMode.None &&
              screenSize >= 1200 &&
              screenSize < 1700
            "
            (view)="onView($event.command, $event.extension)"
            (edit)="onEditCommand($event.command, $event.extension)"
            (classOverview)="onClassOverview($event)"
          ></scl-command-list>
        </main>

        <div
          class="col-xl-5 right-rail"
          *ngIf="viewMode !== ViewMode.None && screenSize >= 1200"
        >
          <ng-container *ngTemplateOutlet="rightRail"></ng-container>
          <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
        </div>
      </div>
    </div>

    <scl-modal *ngIf="viewMode !== ViewMode.None && screenSize < 1200">
      <div class="modal-body">
        <ng-container *ngTemplateOutlet="rightRail"></ng-container>
      </div>
      <ng-container class="modal-footer">
        <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
      </ng-container>
    </scl-modal>

    <ng-template #modalFooter>
      <div class="modal-footer d-flex">
        <a
          href="#"
          *ngIf="!noChanges(viewMode)"
          (click)="resetChanges(viewMode)"
          class="mr-auto"
          >Reset all changes</a
        >
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="onCancel()"
        >
          Close
        </button>
        <button
          *ngIf="viewMode === ViewMode.ViewCommand && canEdit$ | async"
          type="button"
          class="btn btn-outline-success"
          (click)="onEditCommand(command, extension)"
        >
          Edit
        </button>
        <button
          *ngIf="viewMode === ViewMode.ViewEnum && (canEdit$ | async)"
          type="button"
          class="btn btn-outline-success"
          (click)="onEditEnum(enumToDisplayOrEdit)"
        >
          Edit
        </button>
        <button
          *ngIf="
            viewMode === ViewMode.EditCommand || viewMode === ViewMode.EditEnum
          "
          [disabled]="shouldDisableSaveButton(viewMode)"
          type="button"
          class="btn btn-outline-success"
          (click)="onSave(viewMode)"
        >
          Save
        </button>
      </div>
    </ng-template>

    <ng-template #rightRail>
      <scl-command-editor
        *ngIf="viewMode === ViewMode.EditCommand"
        [command]="command"
        [(extension)]="extension"
        [(snippet)]="snippet"
        [extensionNames]="extensionNames$ | async"
        [supportInfo]="getCommandSupportInfo(command, extension) | async"
        [types]="getExtensionTypes(extension) | async"
        [commands]="getExtensionCommands(extension) | async"
        (hasError)="editorHasError = $event"
      ></scl-command-editor>
      <scl-command-info
        *ngIf="viewMode === ViewMode.ViewCommand"
        [command]="command"
        [game]="game"
        [enumNames]="enumNames$ | async"
        [snippet]="getSnippet(extension, command.id) | async"
        [supportInfo]="getCommandSupportInfo(command, extension) | async"
        (classOverview)="onClassOverview($event)"
      >
      </scl-command-info>
      <scl-class-overview
        *ngIf="viewMode === ViewMode.ViewClass"
        [className]="classToDisplay$ | async"
        [classCommands]="classCommands$ | async"
        (view)="onView($event.command, $event.extension)"
      ></scl-class-overview>
      <scl-enum-overview
        *ngIf="viewMode === ViewMode.ViewEnum && enumToDisplayOrEdit"
        [enumToView]="enumToDisplayOrEdit"
      ></scl-enum-overview>
      <scl-enum-editor
        *ngIf="viewMode === ViewMode.EditEnum && enumToDisplayOrEdit"
        [enumToEdit]="enumToDisplayOrEdit"
        (hasError)="editorHasError = $event"
        (delete)="onDeleteEnum()"
      ></scl-enum-editor>
    </ng-template>
  </ng-container>
</ng-container>
