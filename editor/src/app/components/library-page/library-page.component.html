<ng-container *ngIf="viewMode$ | async as viewMode">
  <ng-container *ngIf="game$ | async as game">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 col-xl-2 left-rail">
          <scl-download-panel [game]="game"></scl-download-panel>
          <scl-filter-panel [game]="game"></scl-filter-panel>
        </div>

        <main
          class="col-12"
          [ngClass]="{
            'col-xl-5': viewMode !== ViewMode.None,
            'col-xl-8': viewMode === ViewMode.None
          }"
        >
          <div class="d-flex flex-row align-items-center mb-3">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a routerLink="/">{{ "ui.header.home" | translate }}</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                  {{ game | gameTitle }}
                </li>
              </ol>
            </nav>
            <button
              *ngIf="canEdit$ | async"
              class="btn btn-outline-secondary ml-auto dropdown-toggle"
              data-toggle="dropdown"
              data-offset="0,0"
              aria-haspopup="true"
              aria-expanded="false"
            >
              {{ "ui.layout.new" | translate }}
            </button>
            <div class="dropdown-menu dropdown-menu-right">
              <a
                class="dropdown-item"
                [routerLink]="['/', game, 'enums', 'new']"
                >{{ "ui.layout.newEnum" | translate }}</a
              >
              <a
                class="dropdown-item"
                [routerLink]="['/', game, DEFAULT_EXTENSION, 'new']"
                >{{ "ui.layout.newCommand" | translate }}</a
              >
            </div>
          </div>

          <scl-command-list
            [game]="game"
            [canEdit]="canEdit$ | async"
            [narrowed]="
              viewMode !== ViewMode.None &&
              screenSize >= 1200 &&
              screenSize < 1700
            "
          ></scl-command-list>
        </main>

        <div
          class="col-xl-5 right-rail"
          *ngIf="viewMode !== ViewMode.None && screenSize >= 1200"
        >
          <ng-container *ngTemplateOutlet="rightRail"></ng-container>
          <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
        </div>
      </div>
    </div>

    <scl-modal *ngIf="viewMode !== ViewMode.None && screenSize < 1200">
      <div class="modal-body">
        <ng-container *ngTemplateOutlet="rightRail"></ng-container>
      </div>
      <ng-container class="modal-footer">
        <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
      </ng-container>
    </scl-modal>

    <ng-template #modalFooter>
      <div class="modal-footer d-flex">
        <a
          href="#"
          *ngIf="!noChanges(viewMode)"
          (click)="resetChanges(viewMode)"
          class="mr-auto"
          >{{ "ui.shared.resetChanges" | translate }}</a
        >
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="onCancel()"
        >
          {{ "ui.shared.close" | translate }}
        </button>
        <a
          *ngIf="viewMode === ViewMode.ViewCommand && canEdit$ | async"
          class="btn btn-outline-success"
          [routerLink]="['/', game, extension, command.id, 'edit']"
        >
          {{ "ui.shared.edit" | translate }}
        </a>
        <a
          *ngIf="viewMode === ViewMode.ViewEnum && (canEdit$ | async)"
          class="btn btn-outline-success"
          [routerLink]="['/', game, 'enums', enumToDisplayOrEdit.name, 'edit']"
        >
          {{ "ui.shared.edit" | translate }}
        </a>
        <a
          *ngIf="viewMode === ViewMode.ViewClass && canEdit$ | async"
          class="btn btn-outline-success"
          [routerLink]="['/', game, 'classes', classToDisplayOrEdit, 'edit']"
        >
          {{ "ui.shared.edit" | translate }}
        </a>
        <button
          *ngIf="
            viewMode === ViewMode.EditCommand ||
            viewMode === ViewMode.EditEnum ||
            viewMode === ViewMode.EditClass
          "
          [disabled]="shouldDisableSaveButton(viewMode)"
          type="button"
          class="btn btn-outline-success"
          (click)="onSave(viewMode)"
        >
          {{ "ui.shared.save" | translate }}
        </button>
      </div>
    </ng-template>

    <ng-template #rightRail>
      <scl-command-editor
        *ngIf="viewMode === ViewMode.EditCommand && command"
        [command]="command"
        [(extension)]="extension"
        [(snippet)]="snippet"
        [extensionNames]="extensionNames$ | async"
        [supportInfo]="getCommandSupportInfo(command, extension) | async"
        [types]="getExtensionTypes(extension, DEFAULT_EXTENSION) | async"
        [commands]="getExtensionCommands(extension) | async"
        (hasError)="editorHasError = $event"
        (delete)="onDeleteCommand()"
        (clone)="onCloneCommand($event)"
      ></scl-command-editor>
      <scl-command-info
        *ngIf="viewMode === ViewMode.ViewCommand && command"
        [command]="command"
        [game]="game"
        [enumNames]="enumNames$ | async"
        [snippet]="getSnippet(extension, command.id) | async"
        [supportInfo]="getCommandSupportInfo(command, extension) | async"
        [extension]="extension"
      >
      </scl-command-info>
      <scl-class-overview
        *ngIf="viewMode === ViewMode.ViewClass"
        [game]="game"
        [className]="classToDisplayOrEdit"
        [classCommands]="classCommands$ | async"
      ></scl-class-overview>
      <scl-class-list
        *ngIf="viewMode === ViewMode.ViewAllClasses"
        [game]="game"
        [entities]="entities$ | async"
      ></scl-class-list>
      <scl-class-editor
        *ngIf="viewMode === ViewMode.EditClass"
        [game]="game"
        [className]="classToDisplayOrEdit"
      >
      </scl-class-editor>
      <scl-enum-overview
        *ngIf="viewMode === ViewMode.ViewEnum && enumToDisplayOrEdit"
        [enumToView]="enumToDisplayOrEdit"
        [enumGames]="getGamesWhereEnumExists(enumToDisplayOrEdit.name) | async"
      ></scl-enum-overview>
      <scl-enum-editor
        *ngIf="viewMode === ViewMode.EditEnum && enumToDisplayOrEdit"
        [game]="game"
        [enumToEdit]="enumToDisplayOrEdit"
        [enumGames]="getGamesWhereEnumExists(enumToDisplayOrEdit.name) | async"
        (hasError)="editorHasError = $event"
        (delete)="onDeleteEnum()"
        (clone)="onCloneEnum($event)"
      ></scl-enum-editor>
      <scl-enum-list
        *ngIf="viewMode === ViewMode.ViewAllEnums"
        [game]="game"
        [enumNames]="enumNames$ | async"
      ></scl-enum-list>
    </ng-template>
  </ng-container>
</ng-container>
