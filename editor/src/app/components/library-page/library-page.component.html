<div class="container-fluid">
  <div class="row">
    <div class="col-12 col-xl-2 left-rail" *ngIf="game$ | async as game">
      <scl-download-panel [game]="game"></scl-download-panel>
      <scl-filter-panel [game]="game"></scl-filter-panel>
    </div>

    <main
      class="col-12"
      [ngClass]="{ 'col-xl-5': command, 'col-xl-8': !command }"
    >
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            {{ game$ | async | gameTitle }}
          </li>
        </ol>
      </nav>
      <scl-command-list
        [game]="game$ | async"
        [canEdit]="canEdit$ | async"
        [narrowed]="command && screenSize >= 1200 && screenSize < 1700"
        (view)="onView($event.command, $event.extension)"
        (edit)="onEdit($event.command, $event.extension)"
      ></scl-command-list>
    </main>

    <div class="d-none d-xl-block col-xl-5 right-rail" *ngIf="command">
      <ng-container *ngTemplateOutlet="commandViewer"></ng-container>
      <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
    </div>
  </div>
</div>

<scl-modal *ngIf="command && screenSize < 1200">
  <div class="modal-body">
    <ng-container *ngTemplateOutlet="commandViewer"></ng-container>
  </div>
  <ng-container class="modal-footer">
    <ng-container *ngTemplateOutlet="modalFooter"></ng-container>
  </ng-container>
</scl-modal>

<ng-template #modalFooter>
  <div class="modal-footer d-flex">
    <a href="#" *ngIf="!noChanges()" (click)="resetChanges()" class="mr-auto"
      >Reset all changes</a
    >
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="onCancel()"
    >
      Close
    </button>
    <button
      *ngIf="viewMode === ViewMode.View && canEdit$ | async"
      type="button"
      class="btn btn-outline-success"
      (click)="onEdit(command, extension)"
    >
      Edit
    </button>
    <button
      *ngIf="viewMode === ViewMode.Edit"
      [disabled]="shouldDisableSaveButton()"
      type="button"
      class="btn btn-outline-success"
      (click)="onSave()"
    >
      Save
    </button>
  </div>
</ng-template>

<ng-template #commandViewer>
  <scl-command-editor
    *ngIf="viewMode === ViewMode.Edit"
    [command]="command"
    [(extension)]="extension"
    [(snippet)]="snippet"
    [extensionNames]="extensionNames$ | async"
    [entities]="getExtensionEntities(extension) | async"
    [supportInfo]="getCommandSupportInfo(command, extension) | async"
    [commands]="getExtensionCommands(extension) | async"
    (hasError)="editorHasError = $event"
  ></scl-command-editor>
  <scl-command-info
    *ngIf="viewMode === ViewMode.View"
    [command]="command"
    [snippet]="getSnippet(extension, command.id) | async"
    [supportInfo]="getCommandSupportInfo(command, extension) | async"
  >
  </scl-command-info>
</ng-template>
